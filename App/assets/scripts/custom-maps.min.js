function initializeMap(){function m(e){var t=e.story,o='<div id="story-popup"><h1>'+t.story_title+'</h1><div class="story-popup_content-box"><p>'+t.description+'</p><p><a href="/stories/'+t.slug+'">View Story</a></p></div></div>';if(null!=e.position){var n=new google.maps.InfoWindow({content:o}),i=new google.maps.Marker({position:e.position,icon:p[e.type].icon,map:map});i.addListener("click",function(){a&&a.close(),a=n,n.open(map,i),$("#story-popup").parent().parent().parent().siblings().addClass("outer-box"),$(".outer-box > div:nth-child(2)").addClass("out-box__inner-box"),$(".outer-box div:nth-child(3) div").addClass("box-arrow")})}}function c(e,t){return function(o){var n=o.results[0].geometry.location,a=new google.maps.LatLng(n.lat,n.lng),i={position:a,type:e.category,story:e};setTimeout(function(){m(i)},15*t)}}var e={center:new google.maps.LatLng(0,0),zoom:3,minZoom:3,maxZoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:[{featureType:"road",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"water",stylers:[{lightness:50}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}]},t=["256px","512px","1024px","100%"],a=!1,i=document.getElementById("map");map=new google.maps.Map(i,e);var s=78,r=-75;google.maps.event.addListener(map,"center_changed",function(){var e=map.getBounds(),t=e.getNorthEast(),o=e.getSouthWest(),n=map.getCenter();t.lat()>s&&map.setCenter({lat:n.lat()-(t.lat()-s),lng:n.lng()}),o.lat()<r&&map.setCenter({lat:n.lat()-(o.lat()-r),lng:n.lng()})}),google.maps.event.addListener(map,"zoom_changed",function(){zoom=map.getZoom(),zoom<4?i.style.width=t[zoom]:i.style.width=t[3],google.maps.event.trigger(map,"resize")});var l="http://sandbox.travelledwriters.com/assets/map/icons/",p={continent:{icon:l+"pin.png"},paperplane:{icon:l+"paper-plane.png"},mountains:{icon:l+"mountains.png"},scubadiving:{icon:l+"scubadiving.png"},restaurant:{icon:l+"restaurant.png"},cooking:{icon:l+"cooking.png"},train:{icon:l+"train.png"},airplane:{icon:l+"airplane.png"},bus:{icon:l+"bus.png"},religious:{icon:l+"religious.png"}};$.ajax({type:"POST",url:"stories/ajax/stories_list",dataType:"json",success:function(e){for(var t=0;t<e.length;t++)$.getJSON("http://maps.googleapis.com/maps/api/geocode/json?address="+encodeURI(e[t].location+","+e[t].country)+"&sensor=false",c(e[t],t))}})}var documentReady=function(){initializeMap()};$(document).on("turbolinks:load",documentReady),$(document).on("ready",documentReady);